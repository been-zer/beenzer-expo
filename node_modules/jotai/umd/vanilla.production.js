!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((n="undefined"!=typeof globalThis?globalThis:n||self).jotaiVanilla={})}(this,(function(n){"use strict";var t=0;var e,r=function(n){return"init"in n},i=function(n){return!!n.write},o=new WeakMap,a=function(n,t){var e=o.get(n);e&&(o.delete(n),e(t))},u=function(n,t){return"v"in n&&"v"in t&&Object.is(n.v,t.v)},f=function(n,t){return"e"in n&&"e"in t&&Object.is(n.e,t.e)},c=function(n){return"v"in n&&n.v instanceof Promise},v=function(n){if("e"in n)throw n.e;return n.v},l=function(){var n=new WeakMap,t=new WeakMap,e=new Map,l=function(t){return n.get(t)},d=function(t,r){var i=n.get(t);if(n.set(t,r),e.has(t)||e.set(t,i),i&&c(i)){var o="v"in r?r.v instanceof Promise?r.v:Promise.resolve(r.v):Promise.reject(r.e);a(i.v,o)}},s=function(n,t,e){var r=new Map,i=!1;e.forEach((function(e){var o=e===n?t:l(e);o&&(r.set(e,o),t.d.get(e)!==o&&(i=!0))})),(i||t.d.size!==r.size)&&(t.d=r)},g=function(n,t,e){var r=l(n),i={d:(null==r?void 0:r.d)||new Map,v:t};return e&&s(n,i,e),r&&u(r,i)&&r.d===i.d?r:(d(n,i),i)},h=function n(e){var a=l(e);if(a&&(a.d.forEach((function(r,i){i===e||t.has(i)||n(i)})),Array.from(a.d).every((function(n){var t=n[0],r=n[1];return t===e||l(t)===r}))))return a;var u,c,h=new Set,w=!0,p={get signal(){return u||(u=new AbortController),u.signal},get setSelf(){return!c&&i(e)&&(c=function(){if(!w){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return m.apply(void 0,[e].concat(t))}}),c}};try{var y=e.read((function(t){if(h.add(t),t===e){var i=l(t);if(i)return v(i);if(r(t))return t.init;throw new Error("no atom init")}var o=n(t);return v(o)}),p);if(y instanceof Promise){var E,b=new Promise((function(n,t){y.then((function(t){b.status="fulfilled",b.value=t,n(t)}),(function(n){b.status="rejected",b.reason=n,t(n)})).finally((function(){g(e,b,h)})),E=function(t){return n(t)}}));return b.status="pending",function(n,t){o.set(n,t),n.catch((function(){})).finally((function(){return o.delete(n)}))}(b,(function(n){var t;n&&E(n),null==(t=u)||t.abort()})),g(e,b,h)}return g(e,y,h)}catch(n){return function(n,t,e){var r=l(n),i={d:(null==r?void 0:r.d)||new Map,e:t};return e&&s(n,i,e),r&&f(r,i)&&r.d===i.d?r:(d(n,i),i)}(e,n,h)}finally{w=!1}},w=function(n,t){return!t.l.size&&(!t.t.size||1===t.t.size&&t.t.has(n))},p=function n(e){var r=t.get(e);null==r||r.t.forEach((function(t){if(t!==e){var r=l(t),i=h(t);r&&u(r,i)||n(t)}}))},y=function n(t){for(var e=!0,i=function(n){return v(h(n))},o=function(i){for(var o,a=arguments.length,f=new Array(a>1?a-1:0),c=1;c<a;c++)f[c-1]=arguments[c];if(i===t){if(!r(i))throw new Error("atom not writable");var v=l(i),d=g(i,f[0]);v&&u(v,d)||p(i)}else o=n.apply(void 0,[i].concat(f));return e||A(),o},a=arguments.length,f=new Array(a>1?a-1:0),c=1;c<a;c++)f[c-1]=arguments[c];var d=t.write.apply(t,[i,o].concat(f));return e=!1,d},m=function(n){for(var t=arguments.length,e=new Array(t>1?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];var i=y.apply(void 0,[n].concat(e));return A(),i},E=function n(e,r){var o={t:new Set(r&&[r]),l:new Set};if(t.set(e,o),h(e).d.forEach((function(r,i){var o=t.get(i);o?o.t.add(e):i!==e&&n(i,e)})),h(e),i(e)&&e.onMount){var a=e.onMount((function(){for(var n=arguments.length,t=new Array(n),r=0;r<n;r++)t[r]=arguments[r];return m.apply(void 0,[e].concat(t))}));a&&(o.u=a)}return o},b=function n(e){var r,i=null==(r=t.get(e))?void 0:r.u;i&&i(),t.delete(e);var o=l(e);o&&(c(o)&&a(o.v),o.d.forEach((function(r,i){if(i!==e){var o=t.get(i);o&&(o.t.delete(e),w(i,o)&&n(i))}})))},M=function(n,e,r){var i=new Set(e.d.keys());null==r||r.forEach((function(e,r){if(i.has(r))i.delete(r);else{var o=t.get(r);o&&(o.t.delete(n),w(r,o)&&b(r))}})),i.forEach((function(e){var r=t.get(e);r?r.t.add(n):t.has(n)&&E(e,n)}))},A=function(){for(;e.size;){var n=Array.from(e);e.clear(),n.forEach((function(n){var e=n[0],r=n[1],i=l(e);if(i){i.d!==(null==r?void 0:r.d)&&M(e,i,null==r?void 0:r.d);var o=t.get(e);!o||r&&!c(r)&&(u(r,i)||f(r,i))||o.l.forEach((function(n){return n()}))}}))}};return{get:function(n){return v(h(n))},set:m,sub:function(n,e){var r=function(n){var e=t.get(n);return e||(e=E(n)),e}(n);A();var i=r.l;return i.add(e),function(){i.delete(e),function(n){var e=t.get(n);e&&w(n,e)&&b(n)}(n)}}}};n.atom=function(n,e){var r="atom"+ ++t,i={toString:function(){return r}};return"function"==typeof n?i.read=n:(i.init=n,i.read=function(n){return n(i)},i.write=function(n,t,e){return t(i,"function"==typeof e?e(n(i)):e)}),e&&(i.write=e),i},n.createStore=l,n.getDefaultStore=function(){return e||(e=l()),e}}));
